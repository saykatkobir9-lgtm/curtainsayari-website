import {a,h as h$1,b}from'./chunk-5WYCZ45X.js';import {memo,useMemo,useContext,useState,useEffect}from'react';import {jsx,jsxs}from'react/jsx-runtime';import {createHighlighter}from'shiki';import {createJavaScriptRegexEngine}from'shiki/engine/javascript';var H=a("block","before:content-[counter(line)]","before:inline-block","before:[counter-increment:line]","before:w-4","before:mr-4","before:text-[13px]","before:text-right","before:text-muted-foreground/50","before:font-mono","before:select-none"),C=memo(({children:o,result:e,language:t,className:r,...n})=>{let l=useMemo(()=>({backgroundColor:e.bg,color:e.fg}),[e.bg,e.fg]);return jsx("pre",{className:a(r,"p-4 text-sm dark:bg-(--shiki-dark-bg)!"),"data-language":t,"data-streamdown":"code-block-body",style:l,...n,children:jsx("code",{className:"[counter-increment:line_0] [counter-reset:line]",children:e.tokens.map((a,i)=>jsx("span",{className:H,children:a.map((s,g)=>jsx("span",{className:"dark:bg-(--shiki-dark-bg)! dark:text-(--shiki-dark)!",style:{color:s.color,backgroundColor:s.bgColor,...s.htmlStyle},...s.htmlAttrs,children:s.content},g))},i))})})},(o,e)=>o.result===e.result&&o.language===e.language&&o.className===e.className);var y=({className:o,language:e,style:t,...r})=>jsx("div",{className:a("my-4 w-full overflow-hidden rounded-xl border border-border",o),"data-language":e,"data-streamdown":"code-block",style:{contentVisibility:"auto",containIntrinsicSize:"auto 200px",...t},...r});var x=({language:o,children:e})=>jsxs("div",{className:"flex items-center justify-between bg-muted/80 p-3 text-muted-foreground text-xs","data-language":o,"data-streamdown":"code-block-header",children:[jsx("span",{className:"ml-1 font-mono lowercase",children:o}),jsx("div",{className:"flex items-center gap-2",children:e})]});var M=createJavaScriptRegexEngine({forgiving:true}),p=new Map,h=new Map,d=new Map,$=(o,e)=>`${o}-${e[0]}-${e[1]}`,E=(o,e,t)=>{let r=o.slice(0,100),n=o.length>100?o.slice(-100):"";return `${e}:${t[0]}:${t[1]}:${o.length}:${r}:${n}`},A=(o,e)=>{let t=$(o,e);if(p.has(t))return p.get(t);let r=createHighlighter({themes:e,langs:[o],engine:M});return p.set(t,r),r},k=(o,e,t,r)=>{let n=E(o,e,t);return h.has(n)?h.get(n):(r&&(d.has(n)||d.set(n,new Set),d.get(n).add(r)),A(e,t).then(l=>{let a=l.codeToTokens(o,{lang:e,themes:{light:t[0],dark:t[1]}});h.set(n,a);let i=d.get(n);if(i){for(let s of i)s(a);d.delete(n);}}).catch(l=>{console.error("Failed to highlight code:",l),d.delete(n);}),null)};var le=({code:o,language:e,className:t,children:r,preClassName:n,...l})=>{let{shikiTheme:a}=useContext(h$1),i=useMemo(()=>({bg:"transparent",fg:"inherit",tokens:o.split(`
`).map(u=>[{content:u,color:"inherit",bgColor:"transparent",htmlStyle:{},offset:0}])}),[o]),[s,g]=useState(i);return useEffect(()=>{let u=k(o,e,a);if(u){g(u);return}k(o,e,a,R=>{g(R);});},[o,e,a]),jsx(b.Provider,{value:{code:o},children:jsxs(y,{language:e,children:[jsx(x,{language:e,children:r}),jsx(C,{className:t,language:e,result:s,...l})]})})};export{le as CodeBlock};